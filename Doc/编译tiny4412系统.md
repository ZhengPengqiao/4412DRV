# <center>编译tiny4412系统</center>

## 编译uboot

>本u-boot源代码由三星原厂提供，并由友善之臂修改移植，以适用于Tiny4412开发板平台。

### Build uboot

* 配置编译环境
  * arm-linux-gcc-4.5.1-v6-vfp-20120301.tgz，并设置好环境变量PATH，保证可以正常使用。
* 解压并编译ubootcd sd_fuse/tiny4412
    sudo ./sd_fusing.sh /dev/sdb
  ```C
  tar xzf uboot_tiny4412_0929.tar.gz
  cd uboot_tiny4412
  make tiny4412_config
  make
  ```
* 编译 用于生成bl2 的工具
  ```C
  方法1：make -C sd_fuse
  方法2：cd sd_fuse; make
  ```

### 制作启动 Tiny4412 的SD卡

* 先准备一张4G或以上的SDHC卡
  * 注意：该卡的已有数据将会被破坏，因此请先对SD卡上的数据进行备份。
  * 将uboot和三星特殊引导代码烧录进SD卡中
  * 假设SD卡识别的设备名是:/dev/sdb
    ```C
    cd sd_fuse/tiny4412
    sudo ./sd_fusing.sh /dev/sdb
    ```

## 将对应代码保存在linux-3.5同级目录，增加权限，运行后将在同级目录中的image中存在编译好的内核

### 编译linux-qt内核

```bash
#!/bin/bash
mkdir -p ./image
mkdir -p ./image/modules
cd ./linux-3.5
cp ./tiny4412_linux_defconfig .config
make -j4
make modules -j4
make modules_install INSTALL_MOD_PATH=../image/modules

cp ./arch/arm/boot/zImage ../image
cd ../image/modules
tar jcvf ../modules.tar.bz2 ./*
```

### 编译linux-ubuntu内核

```bash
#!/bin/bash
mkdir -p ./image
mkdir -p ./image/modules
cd ./linux-3.5
cp ./tiny4412_ubuntu_defconfig_rndis .config
make -j4
make modules -j4
make modules_install INSTALL_MOD_PATH=../image/modules

cp ./arch/arm/boot/zImage ../image
cd ../image/modules
tar jcvf ../modules.tar.bz2 ./*
```

### 编译linux-android内核

```bash
#!/bin/bash
mkdir -p ./image
mkdir -p ./image/modules
cd ./linux-3.5
cp ./tiny4412_android_defconfig .config
make -j4
make modules -j4
make modules_install INSTALL_MOD_PATH=../image/modules

cp ./arch/arm/boot/zImage ../image
cd ../image/modules
tar jcvf ../modules.tar.bz2 ./*
```

**************************************************************************************
**************************************************************************************

## 制作文件镜像，或者挂在文件镜像

* 得到system.img
* $simg2img  system.img  system_raw.img
* $mkdir  system
* mount -t ext4 -o loop system_raw.img system
* .... "随意"修改system目录下的文件
* $./make_ext4fs -s -l 512M -a system system_new.img system    #512M表分区大小 第一个system表示挂载点为/system, 第二个system表示system目录。
* 新生成的system_new.img就可以用来烧写了。

## 如果uboot中没有支持TRUSTZONE，则内核中就不能选择此选项： CONFIG_ARM_TRUSTZONE

```text
    CONFIG_ARM_TRUSTZONE
    -->System type
        -->Support TrustZone-enabled Trusted Execution Evvironment 
```

## 开启内核调试功能：

```text
    CONFIG_DEBUG_LL
    -->Kernel hacking 
        -->Kernel low-level debuging functions
```

## 从SD卡中启动的Uboot启动参数

```text
bootargs=root=/dev/mmcblk0p2 console=ttySAC0,115200 lcd=S70 ctp=2
bootcmd=fatload mmc 0:1 0x40008000 zImage;bootm 0x40008000
```

## 错误：Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000100

* 文件系统有问题，使用了iMX6_ubuntu_12.04.tgz文件系统可以正常显示
